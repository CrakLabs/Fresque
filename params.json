{"name":"Fresque","body":"#Fresque\r\n\r\nFresque is a command line tool to manage your php-resque workers.\r\n\r\n\r\n##Prerequisites\r\n\r\nIf you don't know what is *resque* or *redis*, take a look at their official website :\r\n- Redis : http://redis.io/\r\n- Resque : https://github.com/defunkt/resque/\r\n- Php-Resque : https://github.com/chrisboulton/php-resque/\r\n\r\nThis tool is intended to facilitate your life by making interfacing with php-resque more easier and more friendly.\r\nYou should already have some knowledge about php-resque, and have php-resque installed and running.  \r\nI'll assume in this tutorial that you have sufficient knowledge to start a worker normally with php-resque.\r\n\r\n\r\n##What is Fresque\r\n\r\nFresque is a command line tool.\r\nBut instead of starting a worker with\r\n\t\r\n\tQUEUE=file_serve php resque.php\r\n\t\r\nyou do\r\n\r\n\tfresque start -q file_serve\r\n\t\r\nIt's more friendly, and provides more options, like `restart`, `stop`, etc …  \r\nPhp-resque, and resque, by default doesn't provide an out-of-the-box way to stop your workers. You just kill the worker process. With Fresque, you'll enjoy stopping and restarting your workers at gogo.\r\n\r\n\r\n##Configuration\r\n\r\nA fresque.ini file is provided to set your workers default parameters, and other options used by fresque, such as redis connection options.  \r\nit's well documented, and you shouldn't have difficulties filling it.\r\n\r\n\r\n##Usage\r\n\r\n*Some examples are available at the end of this page.*\r\n\r\nIt's often wise to start by adding the fresque executable to your system path.\r\nYou then just call \r\n\r\n\tfresque <command>\r\n\t\r\nOr if you didn't add it,\r\n\r\n\tcd /path/to/the/resque/executable\r\n\t./fresque <command>\r\n\t\r\n\r\n\t\r\nThere's a bunch of interesting commands available :\r\n\r\n* **start**\r\n\r\nTo start a new resque worker. Be default, it will use the default configuration defined in you fresque.ini for the queue name, the pooling frequency, and other various options. You can override all of them with an option flag. Available options :\r\n\r\n> `-u` or `--user` : User running the php process. Should be the user running your php application, usually **www-data** for apache. Using a different user could lead to permissions problems in some cases.\r\n> \r\n> `-q` or `--queue` : A list of queues name, separated with a comma.\r\n\r\n> `-i` or `--interval` : Pooling frequency. Number of seconds between each pooling.\r\n\r\n> `-n` or `--workers` : Number of workers working on the same queue. Uses pcntl to fork the process, ensure that you PHP is compiled with it.\r\n\r\n> `-l` or `--log` : Absolute path to the log file. You can set a different log for each worker. The `--user` must have permission to read and write to that file (and the parent folder, since the file will be created if non-existent).\r\n\r\n\r\nFor creating multiple queues with different options, just run `start` again.\r\n\r\n\r\n* **stop**\r\n\r\nTo shutdown all resque workers. Will wait for all jobs to finish, then shutdown all workers.\r\n\r\n> `-f` or `--force` : Force shutdown, without waiting for the jobs to finish. All jobs will fail.\r\n\r\n* **restart**\r\n\r\nTo restart all the workers, with their previous settings.\r\n\r\n* **load**\r\n\r\nTo start a batch of pre-defined queues (set in your configuration file). See fresque.ini for more informations.\r\n\r\n* **stats**\r\n\r\nDisplay total number of failed/processed jobs, as well as various stats for each workers.\r\n\r\n* **tail**\r\n\r\nTail the workers' logs.\r\n\r\n* **enqueue**\r\n\r\nEnqueue a job. Should be used for testing purpose only. Takes 3 arguments :\r\n \r\n> **queuename**  : Name of the queue you will enqueue this job to  \r\n> **jobclass** : Name of the class that will perform the job, and that your application autoloader will have to load.  \r\n> **arguments** : Other arguments you want to pass to your jobs.\r\n\r\n*Successfully enqueuing a job does not means it will perform it successfully. See notes*\r\n\r\n\r\n* **test**\r\n\r\nTest your configuration. If no options provided, it will test you fresque.ini. It accepts all options, to let you test them.\r\n\r\nFinally, there's some global options, that can be used for all commands. Default value in your config file will be used unless you use these.\r\n\r\n> `-s` or `--host` : Redis hostname\r\n\r\n> `-p` or `--port` : Redis port\r\n\r\n> `-b` or `--lib` : Absolute path to the php-resque library. Used when you already have your own, and don't want to use the one shipped with fresque.\r\n\r\n> `-c` or `--config` : Absolute path to your config file. You can use different config for different workers. Default one is *fresque.ini*, in the same directory as the executable.\r\n\r\n> `-a` or `--autoloader` : Absolute path to your application entry point. Usually, it should be the file that will autoload all your job classes.\r\n\r\n\r\n##Examples\r\n\r\nLet's start a worker with the default settings defined in the config file (fresque.ini)\r\n\r\n\tfresque start\r\n\r\nLet's start another worker, named *activity*, with a pooling frequency of 1 second. Also. I want two workers working on this queue.\r\n\r\n\tfresque start -q activity -i 1 -n 2\r\n\r\nThen, I want another worker, that will work on the queues *default* and *activity* at the same time.\r\n\r\n\tfresque start -q default,activity\r\n\t\r\nOh wait, I have another resque on another redis server. I want to log its activities in an other log file : remote.log\r\n\r\n\tfresque start -s 192.168.1.26 -p 6390 -q myspecialqueue -l /path/to/remote.log\r\n\t\r\nIf you have your config file elsewhere, and your php-resque lib elsewhere also\r\n\r\n\tfresque start -c /path/to/my-config.ini -b /path/to/my/custom/php-resque\r\n\r\nTo view stats of your workers (to know how many you have, processed/failed jobs count, uptime)\r\n\r\n\tfresque stats\r\n\t\r\nIt should output something like that \r\n\r\n\tPHPResque Statistics\r\n\r\n\tJobs Stats\r\n\t   Processed Jobs : 18617\r\n\t   Failed Jobs    : 319\r\n\t\r\n\tWorkers Stats\r\n\t   Active Workers : 6\r\n\t\tWorker : KAMISAMA-MAC.local:33197:default\r\n\t\t - Started on     : Wed May 16 00:33:04 EDT 2012\r\n\t\t - Uptime         : less than a minute\r\n\t\t - Processed Jobs : 0\r\n\t\t - Failed Jobs    : 0\r\n\t\tWorker : KAMISAMA-MAC.local:33207:default\r\n\t\t - Started on     : Wed May 16 00:33:08 EDT 2012\r\n\t\t - Uptime         : less than a minute\r\n\t\t - Processed Jobs : 0\r\n\t\t - Failed Jobs    : 0\r\n\t\tWorker : KAMISAMA-MAC.local:33215:myspecialqueue\r\n\t\t - Started on     : Wed May 16 00:33:10 EDT 2012\r\n\t\t - Uptime         : less than a minute\r\n\t\t - Processed Jobs : 0\r\n\t\t - Failed Jobs    : 0\r\n\t\tWorker : KAMISAMA-MAC.local:33232:activity\r\n\t\t - Started on     : Wed May 16 00:33:16 EDT 2012\r\n\t\t - Uptime         : less than a minute\r\n\t\t - Processed Jobs : 0\r\n\t\t - Failed Jobs    : 0\r\n\t\tWorker : KAMISAMA-MAC.local:33233:activity\r\n\t\t - Started on     : Wed May 16 00:33:16 EDT 2012\r\n\t\t - Uptime         : less than a minute\r\n\t\t - Processed Jobs : 0\r\n\t\t - Failed Jobs    : 0\r\n\t\tWorker : KAMISAMA-MAC.local:33223:default,activity\r\n\t\t - Started on     : Wed May 16 00:33:13 EDT 2012\r\n\t\t - Uptime         : less than a minute\r\n\t\t - Processed Jobs : 0\r\n\t\t - Failed Jobs    : 0\r\n\t\t \r\nIt's wise to do a `stats` after doing a `start`, to ensure that your workers has been successfully created.  [See Notes]\r\n\r\nRemember that you can use the global options (-s, -p etc …) with any command\r\n\r\n\tfresque stop -c /path/to/my-config.ini -s 192.168.1.26\t\t\r\nLet's enqueue a job to the *activity* queue\r\n\r\n\tfresque enqueue activity PageVisit 5 /index.php 158745693\r\n\t\r\nphp-resque will then run this job, by instanciating the class PageVisit, then calling the `perform()` method with the arguments 5, /index.php and 158745693.\r\nIn order to instanciate the PageVisit class, php-resque should know where to find it. That should be done with you application autoloader (`--include`)\r\n\r\n\r\nOh, and if you want to restart all your workers for whatever reasons\r\n\r\n\tfresque restart\r\n\t\r\nIf you're finished, just\r\n\r\n\tfresque stop\r\n\t\r\nIt'll spout something like that\r\n\r\n\tShutting down Resque Worker complete\r\n\tKilling 6 workers ...\r\n\tKilling 33197\r\n\tKilling 33207\r\n\tKilling 33215\r\n\tKilling 33232\r\n\tKilling 33233\r\n\tKilling 33223\r\n\t\r\nSee notes if it says **There were no active workers to kill …** but you're sure there are some.\r\n\t\r\n###Starting all the workers at once\r\n\t\r\nWe've just created 6 workers, calling `start` 5 times (remember, the second `start` create 2 workers with `-n 2`). But there's a way to start all of them with only one command, useful when you have a lot of workers that you have to start each time.\r\n\r\nJust set all your workers settings in the config file in the [Queues] section (walkthrough available in the config file), then start all of them with\r\n\r\n\tfresque load\r\n\t\r\n\r\n##Notes\r\n\r\n###Always confirm your `start` command with `stats`\r\n\r\nStarting a worker with fresque just send a start command to php-resque, which will be running in another process. Thus, any error occuring with php-resque will not be escalated to fresque.\r\n\r\nThis happens when :\r\n\r\n* The user (`--user`) does not exists\r\n* The user doesn't have sufficient permissions\r\n* There's something wrong (fatal error) in your application autoloader\r\n\r\nThese errors occured within php-resque in another process and can't be detected with fresque, which will still returned a *success* command. A way to confirm that your workers were successfully created is to call `stats`, which will display a list of workers.\r\n\r\nYou can also read your logs, they give you more details as to where the script hanged.\r\n\r\n###You can test your config with `test`\r\n\r\n\r\nA testing tool for testing your configuration file is provided, just call `test`.  \r\nThis will test the minimum requirements to run fresque :\r\n\r\n* Your redis hostname and port are not null\r\n* You can connect to the redis server with the specified hostname:port\r\n* The log file exist and is writeable, or if it doesn't exists, the parent directory is writeable\r\n* The path to the php-resque libraries is valid\r\n* The path to your application autoloader is valid\r\n\r\nThis will not test the content of your application autoloader, so if there's something inside triggering a fatal error, fresque will not know, and return a *success**, but the worker will fail to start, like we just said above.\r\n\r\nYou can test more than the settings inside your config file, by passing options. An option will override the setting defined in the config\r\n\r\n\tfresque test -s 195.168.1.26 -p 6890\r\n\t\r\nThis will test your config file, but with the specified redis hostname and port.\r\n\r\nYou can also test an other config file\r\n\r\n\tfresque test -c /my/other/config/file.ini\r\n\r\nA test result will looks like\r\n\r\n\tTesting configuration\r\n\tRedis configuration .....OK\r\n\tRedis server ............OK\r\n\tLog File ................OK\r\n\tPHPResque library .......OK\r\n\tApplication autoloader ..OK\r\n\t\r\n\tYour settings seems ok\r\n\r\n###`stop` command doesn't stop workers\r\n\r\nThis happens when you try to stop your workers, but it says **There were no active workers to kill …**. And a look with `stats` will tell you that there are. This occurs when the `--user` doesn't have sufficient permissions to kill the workers processes.\r\n\r\n###Consult your logs\r\n\r\nLogs tell you all you need to know about the issue of a job, and the current status of your php-resque workers. It tells you when a job is enqueued, when a job is about to being performed, and its issue (success/fail). It also display all php related errors that may occurs.  \r\nCheck them frequently, as fresque doesn't capture those errors.\r\n\r\n\r\n##Background\r\n\r\nFresque is a derivated works from my other plugin, [cake-resque](https://github.com/kamisama/Cake-Resque), a command line tool to manage php-resque, but inside cakephp console.  \r\nVery convenient, but limited to only cakephp framework. I wanted to release a tool that can work in any php environment. Fresque is more powerfull, since no more binded to a framework.\r\n\r\n##Credits\r\n\r\n* [PHP-Resque](https://github.com/chrisboulton/php-resque) is written by Chris Boulton \r\n* Based on [Resque](https://github.com/defunkt/resque) by defunkt\r\n* Fresque by Wan Chen (kamisama)","tagline":"A command line tool to manage your php-resque workers","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}